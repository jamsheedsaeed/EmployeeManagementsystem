
<!doctype html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<meta http-equiv="Content-Security-Policy" content="block-all-mixed-content" />

<meta charset="UTF-8">
<title>view employee</title>

<link href="/stylesheet/view.css" rel="stylesheet">

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.12.4.min.js"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>


<style>
    body {
      background-image: url("images/newback.jpg");
} 


</style>


<!--<script src="script.js"></script>-->

</head>

<body>

<div>
    
<div>
    <div  ><img src="images/ems.jpg"  height="14%" width="20%" margin=0px>
      <img src="images/empall.jpg"  height="80px" width="500px" align="right">
    </div>
    <div class="nav">
				<ul>
            <li class="active"><a href="/secret">Home<span class="sr-only">(current)</span></a></li>
             <li><a href="/register">Register</a></li>
             <li><a href="/news">News</a></li>
             <li><a href="/events">Events</a></li>
             <li><a href="/events">Notifications</a></li>
             
					<li class="Logout" style="float:right"><a href="/">Logout</a></li>
					<div class="dropdown">
                    <button class="dropbtn">Data View 
                    <i class="fa fa-caret-down"></i>
                    </button>
                                    <div class="dropdown-content">
							<a href="/viewemp">Employees Data</a>
							<a class="active" href="/page/viewstransport">News Data</a>
							<a href="/page/viewsdining">Events Data</a>
							<a href="/page/viewnews">Leaves Details</a>
							<a href="/page/viewnews">Notifications Details</a>
	                       

						</div>
					</div>


				</ul>

      </div>
      <div class="knockout">Employees Record</div>
<br/>

</html>

<script>
var table = '#emptable'
$('#maxRows').on('change', function(){
  $('.pagination').html('')
  var trnum = 0
  var maxRows = parseInt($(this).val())
  var totalRows = $(table+' tbody tr').length
  $(table+' tr:gt(0)').each(function(){
    trnum++
    if(trnum > maxRows){
      $(this).hide()
    }
    if(trnum <= maxRows){
      $(this).show()
    }
  })
  if(totalRows > maxRows){
    var pagenum = Math.ceil(totalRows/maxRows)
    for(var i=1;i<=pagenum;){
      $('.pagination').append('<li data-page="'+i+'">\<span>'+ i++ +'<span class="sr-only">(current)</span></span>\</li>').show()
    }
  }
  $('.pagination li:first-child').addClass('active')
      $('.pagination li').on('click',function(){
      var pagenum = $(this).attr('data-page')
      var trIndex = 0;
        $('.pagination li').removeClass('active')
        $(this).addClass('active')
        $(table+' tr:gt(0)').each(function(){
        trIndex++
        if(trIndex > (maxRows*pagenum) || trIndex <= ((maxRows*pagenum)-maxRows)){
          $(this).hide()
        }else{
          $(this).show()
        }
        })
      })								
})

$(function(){
var id = 0;
  $('table tr:gt(0)').each(function(){
  id++
  $(this).prepend('<td>'+id+'</td>')
  })
})


$(document).ready(function(){  
             $('#search').keyup(function(){  
                  search_table($(this).val());  
             });  
             function search_table(value){  
                  $('#emptable tr').each(function(){  
                       var found = 'false';  
                       $(this).each(function(){  
                            if($(this).text().toLowerCase().indexOf(value.toLowerCase()) >= 0)  
                            {  
                                 found = 'true';  
                            }  
                       });  
                       if(found == 'true')  
                       {  
                            $(this).show();  
                       }  
                       else  
                       {  
                            $(this).hide();  
                       }  
                  });  
             }  
        });

      
</script>

    <title>View Employee Details</title>
    <body>
      <!-- <center><h1>Employees Record</h1></center> -->
  
      <div class="wrap">
          <div class="search">
             <input type="text" id="myInput" onkeyup="myFunction()" class="searchTerm" placeholder="What are you looking for?">
             <button type="submit" class="searchButton">
               <i class="fa fa-search"></i>
            </button>
          </div>
       </div> 
    
<table id="emptable" class="responstable" style="width:100%;  margin-right:50px;" >
  <thead>
    <tr  id = "rowid" >
    <th  width="5%" name="empname" id="empname">Employee Name</th>
    <th width="5%" name="empemail" id="empemail">Email</th>
    <th width="5%" name="empphone" id="empphone">Phone</th>
    <th width="5%" name="empadd" id="empadd">Address</th>
    <th width="5%" name="empdept" id="empdept">Department</th>
    <th width="5%" name="empbir" id="empbir">Birth Date</th>
    <th width="5%" name="empsal" id="empsal">Action View</th>
    <th width="5%">Action Delete</th>
    <th width="5%">Action Update</th>

  </tr>
</thead>
<tbody id="customer-rows">
 
</tbody>

 </table>





 

 <!-- Modal Code For Just View -->
 <div id="add_data_Modal" class="modal fade">  
    <div class="modal-dialog">  
         <div class="modal-content">  
              <div class="modal-header">  
                   <button type="button" class="close" data-dismiss="modal">&times;</button>  
                 <center> <h4 class="modal-title">Employee Details</h4>  </center> 
              </div>  
              <div class="modal-body">  
                   <form method="post" id="insert_form">  


                      <div class="modal-header">  
                          <center><h4 class="modal-title">Personal Details</h4> </center> 
                           </div>
                        <label>Employee Name</label>  
                        <input  name="name" id="name" class="form-control" readonly/>  
                        <br />  

                        <label>Father Name</label>  
                        <input type="text" name="fname" id="fname" class="form-control" readonly />  
                        <br />  

                        <label>Email</label>  
                        <input type="text" name="email" id="email" class="form-control" readonly/>  
                        <br />  

                        <label>Phone</label>  
                        <input type="text" name="phone" id="phone" class="form-control" readonly />  
                        <br />  

                        <label>Gender</label>  
                        <input type="text" name="gender" id="gender" class="form-control" readonly />  
                        <br />

                        <label>Date Of Birth</label>  
                        <input type="text" name="dob" id="dob" class="form-control" readonly />  
                        <br />

                        <label>Employee Address</label>  
                        <textarea name="address" id="address" class="form-control" readonly></textarea>  
                        <br />  

                        <div class="modal-header">  
                        <center><h4 class="modal-title">Job Details</h4> </center>
                        </div>

                        <label>Title</label>  
                        <textarea name="title" id="title" class="form-control" readonly></textarea>  
                        <br />
                        
                        <label>Employee Address</label>  
                        <textarea name="department" id="department" class="form-control" readonly></textarea>  
                        <br />  

                        <label>Start Date</label>  
                        <textarea name="sdate" id="sdate" class="form-control" readonly></textarea>  
                        <br />  

                        <label>Salary</label>  
                        <textarea name="salary" id="salary" class="form-control" readonly></textarea>  
                        <br /> 

                        <label>Pay Scale</label>  
                        <textarea name="pscale" id="pscale" class="form-control" readonly></textarea>  
                        <br /> 
                        <div class="modal-header">  
                           <center><h4 class="modal-title">Account Details</h4> </center> 
                            </div>

                        <label>User Name</label>  
                        <textarea name="uname" id="uname" class="form-control" readonly></textarea>  
                        <br /> 

                        <label>Password</label>  
                        <textarea name="password" id="password" class="form-control" readonly></textarea>  
                        <br /> 
                        <div class="modal-header">  
                           <center><h4 class="modal-title">Emergency Details</h4> </center> 
                            </div>

                        <label>Emergency Contact Name</label>  
                        <textarea name="ecname" id="ecname" class="form-control" readonly></textarea>  
                        <br /> 

                        <label>Relationship</label>  
                        <textarea name="relationship" id="relationship" class="form-control" readonly></textarea>  
                        <br /> 

                        <label>Phone</label>  
                        <textarea name="ephone" id="ephone" class="form-control" readonly></textarea>  
                        <br /> 


                        <input type="hidden" name="employee_id" id="employee_id" />  
                       <!-- <input type="submit" name="insert" id="insert" value="Insert" class="btn btn-success" />  -->
                   </form>  
              </div>  
              <div class="modal-footer">  
                   <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>  
              </div>  
         </div>  
    </div>  
</div> 

<script>


$('#emptable').on('click','a.edit-customer', function(e) {

  var dmJSON = "https://employeemanagementsystem.herokuapp.com/employee";
  var employee_id = $(this).attr("rel"); 
  data:{employee_id:employee_id}
 $.getJSON( dmJSON, function(data) {
  console.log(data);
    var idx=1;
    $.each(data, function(i, f) {
      var idx = $(this).data('id');
        idx++;
       // var $popup ="<popup id='"+idx+"' class='mystyles1'><tr>" + "<p>" + f.employeename + "</p></tr>" + "<tr><p>" + f.dob + "</p></tr>" + "<tr><p>" + f.empemail + "</p></tr>" + "<tr><p> " + f.username+ "</p></tr>" + "&nbsp;&nbsp;&nbsp;</popup>"
       // $("#popup-container").append($popup)
       $('#name').val(f.employeename);
       $('#fname').val(f.fname)
       $('#email').val(f.Email)
       $('#phone').val(f.phone)
       $('#gender').val(f.gender)
       $('#dob').val(f.dob)
       $('#address').val(f.address)

       $('#title').val(f.title)
       $('#department').val(f.department)
       $('#sdate').val(f.startdate)
       $('#salary').val(f.salary)
       $('#pscale').val(f.payscale)


       $('#uname').val(f.username)
       $('#password').val(f.Password)


       $('#ecname').val(f.EmgFullName)
       $('#relationship').val(f.Relationship)
       $('#ephone').val(f.EPhone)






       $('#add_data_Modal').modal('show'); 
       
    });
 });



 
});
</script>

    <script>
      
      populateTable();
function populateTable(){
       var mydata;
        var userdata;
      $(document).ready(function(){
        console.log('Unable to put data'); 

       
                $.getJSON("https://employeemanagementsystem.herokuapp.com/employee", function(data){
                    console.log(data);
           
                  $.each(data, function(i, field){
                   
                       $('#emptable').append('<tr  ><td>'+field.employeename+'</td><td>'+field.Email+
                        '</td><td>'+field.phone+'</td><td>'+field.address+'</td><td>'+field.department+'</td><td>'+field.dob+'</td><td><a href="#" rel="'+this._id+'" class="edit-customer btn btn-success">View</a> </td><td><a href="#" id="btn1" class="deleteEmployee btn btn-danger "   rel="' + this._id + '" >delete</a></td> <td><input type="button" name="edit" value="Edit" rel="' + this._id + '" class="btn btn-info edit_data" /></td> </tr>' 
            
                    );

              
                        });
                     
        
                        
     
                })
               
            });
          }

  
$('#emptable tbody').on('click', 'td a.deleteEmployee', function deleteEmployee(event){


    event.preventDefault();
    // Pop up a confirmation dialog
    var confirmation = confirm('Are you sure you want to delete this user?');
    // Check and make sure the user confirmed
    if (confirmation === true) {
        // If they did, do our delete
        $.ajax({
            method:'DELETE',
            type: 'DELETE',
            url: '/employee/'  + $(this).attr('rel'),

        }).done(function( response) {
          
           
          
                      // Check for a successful (blank) response
          
                      if (response.msg == '') {
                       
          
                      }
          
                      else {
                     
                        alert('sucessfully deleted!');
                        location.reload();
                        
          
                      }

});
}else {

// If they said no to the confirm, do nothing

        return false;

    }
})


 </script>

<div id="popupdiv">
</div>

<script type="text/javascript">
  $("details").click("click", function () {
   var id = $(this).attr("rel");
console.log(id);
  $('#popupdiv').modal();
  $.ajax({
          type: "GET",
          contentType: "application/json; charset=utf-8",

          url: "http://localhost:3000/employee"+ id,
         
          data: "",
          dataType: "json",
          success: function (data) { //which contains name,email etc how can i append the  details on to the "popupdiv" div by inserting in to another div
         console.log(data);
          $("<div>").appendTo("#popupdiv").append(data.employeename);
          }
  });
  return false;                     
   });
   </script>





<script>

function popupshow() {
$(function() {
   var dmJSON = "http://localhost:3000/employee";
 
   $.getJSON( dmJSON, function(data) {
    console.log(data);
      var idx=1;
      $.each(data, function(i, f) {
        var myid = 'mypop'+ (i+1); 
          idx++;
          var $popup="<popup id='"+myid+"' class='mystyles1'><tr>" + "<p>" + f.employeename + "</p></tr>" + "<tr><p>" + f.dob + "</p></tr>" + "<tr><p>" + f.empemail + "</p></tr>" + "<tr><p> " + f.username+ "</p></tr>" + "&nbsp;&nbsp;&nbsp;</popup>"
          $("#popup-container").append($popup)
      });
   });
});
}



    function myFunction() {
      var input, filter, table, tr, td, i;
      input = document.getElementById("myInput");
      filter = input.value.toUpperCase();
      table = document.getElementById("emptable");
      tr = table.getElementsByTagName("tr");
      for (i = 0; i < tr.length; i++) {
        td = tr[i].getElementsByTagName("td")[0];
        if (td) {
          if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
            tr[i].style.display = "";
          } else {
            tr[i].style.display = "none";
          }
        }       
      }
    }
    </script>



  <script>  
var trEdit = null;
$(document).on('click', '.edit_data', function(){  
  var table,tr,td,username;
  trEdit = $(this).closest('tr');
  var type = $(this).closest('tr').children('td.username').text();
  var empemail = $(trEdit).find('ed:eq(1)').text;
  $.getJSON("http://localhost:3000/employee", function(data){
    $.each(data, function(i, field){

      if(field._id == 'rel'){
      
     username = field.employeename;
     alert("username:"+username);
      }

    });

  });
  

});



  </script>


    </body>
</html>